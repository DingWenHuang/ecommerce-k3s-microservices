apiVersion: v1
kind: Pod
metadata:
  name: config-smoke-test
  namespace: ecommerce
spec:
  restartPolicy: Never
  containers:
    - name: alpine
      image: alpine:3.20
      command: ["/bin/sh", "-c"]
      args:
        - |
          echo "=== From ConfigMap ==="
          echo "SPRING_PROFILES_ACTIVE=$SPRING_PROFILES_ACTIVE"
          echo "POSTGRES_HOST=$POSTGRES_HOST"
          echo "REDIS_SERVICE_HOST=$REDIS_SERVICE_HOST"
          echo "=== From JWT Secret ==="
          echo "JWT_ACCESS_TTL_SECONDS=$JWT_ACCESS_TTL_SECONDS"
          echo "=== From Postgres Secret ==="
          echo "POSTGRES_DB=$POSTGRES_DB"
          echo "POSTGRES_USER=$POSTGRES_USER"
          echo "=== From Redis Secret (password length only) ==="
          echo "REDIS_PASSWORD_LENGTH=${#REDIS_PASSWORD}"
          sleep 3600
      envFrom:
        - configMapRef:
            name: ecommerce-app-config
        - secretRef:
            name: ecommerce-jwt-secret
        - secretRef:
            name: postgres-secret
      env:
        # Bitnami redis chart 的 password key 通常是 redis-password
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: redis
              key: redis-password
